{"version":3,"sources":["lib/ngJsTree.js"],"names":["$","undefined","jstree","defaults","alltrigger","plugins","options","parent","init","el","opts","trigger","ev","data","call","replace","contextTrigger","vakata","context","_trigger","event_name","dndTrigger","dnd","e","jQuery","angular","jsTreeCtrl","nodeSerialId","vm","nodesFingerprint","__uiNodeId","id","text","type","changeWatcher","arraySource","tokenFn","self","getTokens","result","token","array","isFunction","i","n","length","map","push","subtractAsSets","a","b","inB","applyChanges","newTokens","oldTokens","replacedTokens","removedTokens","removedToken","newToken","onRemoved","onChanged","addedTokens","onAdded","subscribe","scope","$watch","noop","jsTreeDirective","$timeout","restrict","treeData","treeEventsObj","shouldApply","controller","link","elm","attrs","config","nodesWatcher","events","blocked","treeEventHandler","s","cb","args","arguments","fn","$parent","$eval","$root","$$phase","$apply","apply","manageEvents","treeEvents","evMap","split","name","indexOf","tree","on","document","isObject","forEach","getOptions","jsTreeSettings","jsTree","copy","JSON","stringify","core","destroy","pop","node","isDefined","set_type","rename_node","get_node","res","create_node","delete_node","mi","module","directive"],"mappings":"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","file":"ngJsTree.js","sourcesContent":["(function ($, undefined) {\r\n    'use strict';\r\n    $.jstree.defaults.alltrigger = null;\r\n    $.jstree.plugins.alltrigger = function (options, parent) {\r\n        this.init = function (el, opts) {\r\n            if (options) {\r\n                this.trigger = function (ev, data) {\r\n                    parent.trigger.call(this, ev, data);\r\n                    options(ev.replace('.jstree', '') + '.jstree', data);\r\n                };\r\n                var contextTrigger = $.vakata.context._trigger;\r\n                $.vakata.context._trigger = function (event_name) {\r\n                    contextTrigger(event_name);\r\n                    options('context_' + event_name + '.vakata');\r\n                };\r\n                var dndTrigger = $.vakata.dnd._trigger;\r\n                $.vakata.dnd._trigger = function (event_name, e, data) {\r\n                    dndTrigger(event_name, e, data);\r\n                    options('dnd_' + event_name + '.vakata', e, data);\r\n                };\r\n            }\r\n            parent.init.call(this, el, opts);\r\n        };\r\n    };\r\n})(jQuery);\r\n(function (angular) {\r\n    'use strict';\r\n\r\n    //// JavaScript Code ////\r\n    function jsTreeCtrl() {\r\n        /*jshint validthis:true */\r\n        var nodeSerialId = 1;\r\n        var vm = this;\r\n\r\n        vm.nodesFingerprint = function (e) {\r\n            if (!e.__uiNodeId) {\r\n                e.__uiNodeId = nodeSerialId++;\r\n            }\r\n            return '' + e.__uiNodeId + (e.id || '') + (e.text || '') + (e.type || '');\r\n        };\r\n\r\n        vm.changeWatcher = function (arraySource, tokenFn) {\r\n            var self;\r\n            var getTokens = function () {\r\n                var result = [], token, el;\r\n                if (arraySource) {\r\n                    var array = angular.isFunction(arraySource) ? arraySource() : arraySource;\r\n                    for (var i = 0, n = array.length; i < n; i++) {\r\n                        el = array[i];\r\n                        token = tokenFn(el);\r\n                        map[token] = el;\r\n                        result.push(token);\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n            // returns elements in that are in a but not in b\r\n            // subtractAsSets([4, 5, 6], [4, 5, 7]) => [6]\r\n            var subtractAsSets = function (a, b) {\r\n                var result = [], inB = {}, i, n;\r\n                for (i = 0, n = b.length; i < n; i++) {\r\n                    inB[b[i]] = true;\r\n                }\r\n                for (i = 0, n = a.length; i < n; i++) {\r\n                    if (!inB[a[i]]) {\r\n                        result.push(a[i]);\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n\r\n            // Map objects to tokens and vice-versa\r\n            var map = {};\r\n\r\n            var applyChanges = function (newTokens, oldTokens) {\r\n                var i, n, el, token;\r\n                var replacedTokens = {};\r\n                var removedTokens = subtractAsSets(oldTokens, newTokens);\r\n                for (i = 0, n = removedTokens.length; i < n; i++) {\r\n                    var removedToken = removedTokens[i];\r\n                    el = map[removedToken];\r\n                    delete map[removedToken];\r\n                    var newToken = tokenFn(el);\r\n                    // if the element wasn't removed but simply got a new token, its old token will be different from the current one\r\n                    if (newToken === removedToken) {\r\n                        self.onRemoved(el);\r\n                    } else {\r\n                        replacedTokens[newToken] = removedToken;\r\n                        self.onChanged(el);\r\n                    }\r\n                }\r\n\r\n                var addedTokens = subtractAsSets(newTokens, oldTokens);\r\n                for (i = 0, n = addedTokens.length; i < n; i++) {\r\n                    token = addedTokens[i];\r\n                    el = map[token];\r\n                    if (!replacedTokens[token]) {\r\n                        self.onAdded(el);\r\n                    }\r\n                }\r\n\r\n            };\r\n            self = {\r\n                subscribe: function (scope, onChanged) {\r\n                    scope.$watch(getTokens, function (newTokens, oldTokens) {\r\n                        if (!onChanged || onChanged(newTokens, oldTokens) !== false) {\r\n                            applyChanges(newTokens, oldTokens);\r\n                        }\r\n                    }, true);\r\n                },\r\n                onAdded: angular.noop,\r\n                onChanged: angular.noop,\r\n                onRemoved: angular.noop\r\n            };\r\n            return self;\r\n        };\r\n    }\r\n\r\n    function jsTreeDirective($timeout) {\r\n        return {\r\n            restrict: 'A',\r\n            scope: {\r\n                treeData: '=ngModel',\r\n                treeEventsObj: '=?treeEventsObj',\r\n                shouldApply: '&'\r\n            },\r\n            controller: 'jsTreeCtrl',\r\n            link: function link(scope, elm, attrs, controller) {\r\n\r\n                var config = null,\r\n                    nodesWatcher = controller.changeWatcher(scope.treeData, controller.nodesFingerprint),\r\n                    events = [];\r\n\r\n                var blocked = false;\r\n\r\n                function treeEventHandler(s, cb) {\r\n                    return function () {\r\n                        var args = arguments;\r\n                        var fn = s.$parent.$eval(cb);\r\n                        if (!s.$root.$$phase) {\r\n                            s.$parent.$apply(function () {\r\n                                fn.apply(s.$parent, args);\r\n                            });\r\n                        } else {\r\n                            fn.apply(s.$parent, args);\r\n                        }\r\n                    };\r\n                }\r\n\r\n                function manageEvents(s, e, a) {\r\n                    if (a.treeEvents) {\r\n                        var evMap = a.treeEvents.split(';');\r\n                        for (var i = 0; i < evMap.length; i++) {\r\n                            if (evMap[i].length > 0) {\r\n                                var name = evMap[i].split(':')[0];\r\n                                var cb = evMap[i].split(':')[1];\r\n                                if (name.indexOf('.') === -1) {\r\n                                    name += '.jstree';\r\n                                }\r\n                                events.push(name);\r\n                                if (name.indexOf('.vakata') === -1) {\r\n                                    s.tree.on(name, treeEventHandler(s, cb));\r\n                                } else {\r\n                                    $(document).on(name, treeEventHandler(s, cb));\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    if (angular.isObject(s.treeEventsObj)) {\r\n                        angular.forEach(s.treeEventsObj, function (cb, name) {\r\n                            if (name.indexOf('.') === -1) {\r\n                                name += '.jstree';\r\n                            }\r\n                            events.push(name);\r\n                            if (name.indexOf('.vakata') === -1) {\r\n                                s.tree.on(name, function () {\r\n                                    var args = arguments;\r\n                                    if (!s.$root.$$phase) {\r\n                                        s.$parent.$apply(function () {\r\n                                            cb.apply(s.$parent, args);\r\n                                        });\r\n                                    } else {\r\n                                        cb.apply(s.$parent, args);\r\n                                    }\r\n                                });\r\n                            } else {\r\n                                $(document).on(name, function () {\r\n                                    var args = arguments;\r\n                                    if (!s.$root.$$phase) {\r\n                                        s.$parent.$apply(function () { cb.apply(s.$parent, args); });\r\n                                    } else {\r\n                                        cb.apply(s.$parent, args);\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n\r\n                function getOptions() {\r\n                    var jsTreeSettings = attrs.jsTree ? scope.$parent.$eval(attrs.jsTree) : {};\r\n                    config = {};\r\n                    angular.copy(jsTreeSettings, config);\r\n                    var result = JSON.stringify(config);\r\n                    if (config.core) {\r\n                        config.core.data = scope.treeData;\r\n                    }\r\n                    else {\r\n                        config.core = { data: scope.treeData };\r\n                    }\r\n                    if (config.plugins) {\r\n                        config.plugins.push('alltrigger');\r\n                    } else {\r\n                        config.plugins = ['alltrigger'];\r\n                    }\r\n                    config.alltrigger = function (name) {\r\n                        if (!scope.$root.$$phase && events.indexOf(name) === -1) {\r\n                            scope.$apply();\r\n                        }\r\n                    };\r\n                    return result;\r\n                }\r\n\r\n                scope.destroy = function () {\r\n                    events = [];\r\n                    if (attrs.tree) {\r\n                        if (attrs.tree.indexOf('.') !== -1) {\r\n                            var split = attrs.tree.split('.');\r\n                            var tree = split.pop();\r\n                            var context = scope.$parent;\r\n                            for (var i = 0; i < split.length; i++) {\r\n                                context = context[split[i]];\r\n                            }\r\n                            scope.tree = context[tree] = elm;\r\n                        }\r\n                        else {\r\n                            scope.tree = scope.$parent[attrs.tree] = elm;\r\n                        }\r\n\r\n                    } else {\r\n                        scope.tree = elm;\r\n                    }\r\n                    scope.tree.jstree('destroy');\r\n                };\r\n\r\n                scope.init = function () {\r\n                    scope.tree.jstree(config);\r\n                    $timeout(function () {\r\n                        manageEvents(scope, elm, attrs);\r\n                    });\r\n                };\r\n\r\n                nodesWatcher.onChanged = function (node) {\r\n                    if (angular.isDefined(scope.tree.jstree(true).set_type)) {\r\n                        scope.tree.jstree(true).set_type(node.id, node.type);\r\n                    }\r\n                    scope.tree.jstree(true).rename_node(node.id, node.text);\r\n                };\r\n\r\n                nodesWatcher.onAdded = function (node) {\r\n                    $timeout(function () {\r\n                        while (blocked) { }\r\n                        blocked = true;\r\n                        var parent = scope.tree.jstree(true).get_node(node.parent);\r\n                        var res = scope.tree.jstree(true).create_node(parent, node, 'inside', function () {\r\n                            blocked = false;\r\n                        });\r\n                        if (!res) {\r\n                            blocked = false;\r\n                        }\r\n                    });\r\n                };\r\n\r\n                nodesWatcher.onRemoved = function (node) {\r\n                    scope.tree.jstree(true).delete_node(node.id);\r\n                };\r\n\r\n                nodesWatcher.subscribe(scope, function () {\r\n                    if (!scope.shouldApply) {\r\n                        return true;\r\n                    }\r\n                    return scope.shouldApply();\r\n                });\r\n\r\n                scope.$watch(getOptions, function () {\r\n                    scope.destroy();\r\n                    scope.init();\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    //// Angular Code ////\r\n    var mi = angular.module('ngJsTree', []);\r\n    mi.controller('jsTreeCtrl', jsTreeCtrl);\r\n    mi.directive('jsTree', ['$timeout', jsTreeDirective]);\r\n\r\n})(angular);"]}